<link rel="stylesheet" href="https://imagesloaded.desandro.com/styles.css">
<script src="https://cdn.jsdelivr.net/gh/desandro/imagesloaded/imagesloaded.pkgd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

<select id="so1">
  <option value =''>d</option>
  <option selected='selected' value = 'https://slack-imgs.com/?url='>a</option>
  <option value = ''>f</option>
</select>

<button id="add">Add images</button>
<button id="reset">Reset</button>
<div id="status">
<progress max="7" value="0"></progress>
</div>
<div id="image-container"></div>
<textarea  id="txtArea" cols="50" rows="10">
http://p0.itc.cn/q_70/images03/20210109/cedb48d5fab148be8cb4a1b2a79bbbcf.jpeg
http://p0.itc.cn/q_70/images03/20210109/254fab4c1e2c48439775f429afe63a11.jpeg
http://p6.itc.cn/q_70/images03/20210109/03198816bd304d55bd52bc2032509860.jpeg
http://p0.itc.cn/q_70/images03/20210109/166435f26ca74c99bc14a5cbb8d8a060.jpeg
http://p6.itc.cn/q_70/images03/20210109/c3774eb174ac41249d687328a3a76edb.jpeg
http://p2.itc.cn/q_70/images03/20210109/1297318ac13741d0b5a36ece062fff44.jpeg
http://p1.itc.cn/q_70/images03/20210109/dbfa3378d71747859303d014cc3ae9d3.jpeg
http://p9.itc.cn/q_70/images03/20210109/c7396700f9784667a1c976eabe98bcf5.jpeg
http://p3.itc.cn/q_70/images03/20210109/009c86402111409eb87023e079d2f1ec.jpeg
http://p4.itc.cn/q_70/images03/20210109/df76be0ffcf64018a22ca4215e30970b.jpeg
http://p1.itc.cn/q_70/images03/20210109/55cde4d81bbe4c65936a3bf54714a7ec.jpeg
http://p3.itc.cn/q_70/images03/20210109/a220955a76da4e51844c808381e11ed5.jpeg
http://p4.itc.cn/q_70/images03/20210109/54a801cfd66e4829b374a39eae19da9b.jpeg
http://p9.itc.cn/q_70/images03/20210109/453fdf5c318d42f1a68e9671ae9a7e43.jpeg
http://p3.itc.cn/q_70/images03/20210109/f97a61f56db042d4b50b90acdc64bf6e.jpeg
http://p0.itc.cn/q_70/images03/20210109/646727231568410d9be2b1d20a5ca070.jpeg
http://p4.itc.cn/q_70/images03/20210109/3812ac6827d84f37ab49420491879be9.jpeg
http://p7.itc.cn/q_70/images03/20210109/dba9f2f9a05741acb0a1fa773be2667d.jpeg
http://p4.itc.cn/q_70/images03/20210109/9022c9358c9d4629ab07f6a3808e2e57.jpeg
http://p6.itc.cn/q_70/images03/20210109/8baacb6d940146f98f61fca1e3bbd0ef.jpeg
http://p5.itc.cn/q_70/images03/20210109/58fdb1873e304071b33a2a32dad8051b.jpeg
http://p3.itc.cn/q_70/images03/20210109/5671cadb00ed47979eb994eacbffef63.jpeg
http://p2.itc.cn/q_70/images03/20210109/d86d552144e04af4a1ab2eef1e27beb0.jpeg
http://p8.itc.cn/q_70/images03/20210109/cbf4679e76114387954cda412ee009dc.jpeg
http://p5.itc.cn/q_70/images03/20210109/fe775f5dcc6d4ffeb045af7c050c9a64.jpeg
http://p0.itc.cn/q_70/images03/20210109/5d694623e52c4b32a9e4eb6740b03404.jpeg
http://p1.itc.cn/q_70/images03/20210109/4de00e53805f467a9ed374b7326a3602.jpeg
http://p9.itc.cn/q_70/images03/20210109/5504f09da6d04e14bc747646ea8ff0ac.jpeg
http://p2.itc.cn/q_70/images03/20210109/4afc39121f404d81bc0a13c7e680ca7e.jpeg
http://p8.itc.cn/q_70/images03/20210109/e79514bbaaa84385bc6cc17c46359268.jpeg
http://p4.itc.cn/q_70/images03/20210109/11da1d9b65fb44329d87fe3b068eb28b.jpeg
http://p7.itc.cn/q_70/images03/20210109/82111db773cb436dadf5e0f35e34302a.jpeg
http://p5.itc.cn/q_70/images03/20210109/8006c0c3d7274f21bd48362f5dfa526a.jpeg
http://p9.itc.cn/q_70/images03/20210109/f25227a4adfc4ffa952e65bb59b72296.jpeg
http://p9.itc.cn/q_70/images03/20210109/26f47d2de9a94656a6b051ad27892f41.jpeg
http://p8.itc.cn/q_70/images03/20210109/27dec7d7336c47e99a29b5a2bd2a9dcd.jpeg
http://p3.itc.cn/q_70/images03/20210109/5f6abd4ac0e747b78aa06a096474206e.jpeg
http://p1.itc.cn/q_70/images03/20210109/4c7a2240f8e54d83bf5bd6a931193646.jpeg
http://p7.itc.cn/q_70/images03/20210109/29861e0cd9bb4ab0880776ad3ac6b37b.jpeg
http://p3.itc.cn/q_70/images03/20210109/f559b95ded8146719226c84a0c46a044.jpeg
http://p7.itc.cn/q_70/images03/20210109/f744f78b13cf48f4b81bc5b16847cbf0.jpeg
http://p0.itc.cn/q_70/images03/20210109/eba6ce42dbd345a397e8c37cfd6c0cca.jpeg
http://p2.itc.cn/q_70/images03/20210109/d7a689a57117425db6eb516c890c34a9.jpeg
http://p1.itc.cn/q_70/images03/20210109/d0476743b53f4eebb9ced7f840afeab8.jpeg
http://p8.itc.cn/q_70/images03/20210109/437b9336bdd1430c910e25e782d1ffff.jpeg
http://p9.itc.cn/q_70/images03/20210109/5359f97e472743acb769f379758fb98b.jpeg
http://p1.itc.cn/q_70/images03/20210109/1e6b0c884cc44bc09571ac7ada672571.jpeg
http://p3.itc.cn/q_70/images03/20210109/af137e7370344894a851a78cfd5c7eb8.jpeg
http://p0.itc.cn/q_70/images03/20210109/23d56cde7d964083b784af2ec8564fdb.jpeg
http://p1.itc.cn/q_70/images03/20210109/ceff9050e84f410ca9434eec1215d085.jpeg
http://p0.itc.cn/q_70/images03/20210109/03ae97b99d86457d8de8265f71cb9528.jpeg
http://p7.itc.cn/q_70/images03/20210109/8798ab7320394dc9a2dbb6b635ee2338.jpeg
http://p7.itc.cn/q_70/images03/20210109/be27c512508e45888758a9c01ba78c4f.jpeg
http://p2.itc.cn/q_70/images03/20210109/ff8066402fe347378624609b8efe49f4.jpeg
</textarea>

<script type="text/javascript">

textToArray();

f1();

setTimeout( function(){
  f3();
}, 200 );

console.log( lc );

/* jshint browser: true, unused: true, undef: true */
/* globals imagesLoaded: false */


var container = document.querySelector('#image-container');
var statusElem = document.querySelector('#status');
var progressElem = document.querySelector('progress');

var supportsProgress = progressElem &&
  // IE does not support progress
  progressElem.toString().indexOf('Unknown') === -1;

var loadedImageCount, imageCount;

document.querySelector('#add').onclick = function() {
  // add new images
  var fragment = getItemsFragment();
  container.insertBefore( fragment, container.firstChild );
  // use ImagesLoaded
  var imgLoad = imagesLoaded( container );
  imgLoad.on( 'progress', onProgress );
  imgLoad.on( 'always', onAlways );
  // reset progress counter
  imageCount = imgLoad.images.length;
  resetProgress();
  updateProgress( 0 );
};

// reset container
document.querySelector('#reset').onclick = function() {
  empty( container );
};

// -----  ----- //

function resetProgress() {
  statusElem.style.opacity = 1;
  loadedImageCount = 0;
  if ( supportsProgress ) {
    progressElem.setAttribute( 'max', imageCount );
  }
}

function updateProgress( value ) {
  if ( supportsProgress ) {
    progressElem.setAttribute( 'value', value );
  } else {
    // if you don't support progress elem
    setText( statusElem, value + ' / ' + imageCount );
  }
}

// triggered after each item is loaded
function onProgress( imgLoad, image ) {
  // change class if the image is loaded or broken
  image.img.parentNode.className = image.isLoaded ? '' : 'is-broken';
  // update progress element
  loadedImageCount++;
  updateProgress( loadedImageCount );
}

// hide status when done
function onAlways() {
  statusElem.style.opacity = 0;
}

// -----  ----- //

// return doc fragment with
function getItemsFragment() {
  var fragment = document.createDocumentFragment();
  for ( var i = 0; i < lines.length; i++ ) {
    var item = getImageItem(lines[i],i);
    fragment.appendChild( item );
  }
  return fragment;
}

// return an <li> with a <img> in it
function getImageItem(u,i) {
  var p = document.getElementById('so1').value;
  var item = document.createElement('a');
  item.setAttribute('data-fancybox','gallery');
  var li = document.createElement('li');
  li.className = 'is-loading';
  var img = document.createElement('img');
  if (lc[i]==true) {
    img.src = u;
    item.href=u;
    } else {
      img.src = p + u;
      item.href = p + u;
      }
      item.appendChild( li );
      li.appendChild( img );
  return item;
}

// ----- set text helper ----- //

var docElem = document.documentElement;
var textSetter = docElem.textContent !== undefined ? 'textContent' : 'innerText';

function setText( elem, value ) {
  elem[ textSetter ] = value;
}

function empty( elem ) {
  while ( elem.firstChild ) {
    elem.removeChild( elem.firstChild );
  }
}

function textToArray(){
  var area = document.getElementById("txtArea");
  lines = area.value.replace(/\r\n/g,"\n").split("\n").filter(line => line);
  lc=[];
}

function f1() {
  for ( var i = 0; i < lines.length; i++ ) {
    f2(lines[i],i);
  }
  console.log( lines );
}

function f2(src,i) {
  var img = new Image();
  img.src = src;
  var imgLoad = imagesLoaded( img );
  d = 0;
  imgLoad.on( 'progress', function( instance, image ) {
    lc[i]=image.isLoaded;
  var result = image.isLoaded ? 'loaded' : 'broken';
  d=d+1
  myv( i+'image is ' + result + ' for ' + image.img.src );
});
}

function f3() {
  var container = document.querySelector('#image-container');
  // add new images
  var fragment = getItemsFragment();
  container.insertBefore( fragment, container.firstChild );
  // use ImagesLoaded
  var imgLoad = imagesLoaded( container );
  imgLoad.on( 'progress', onProgress );
  imgLoad.on( 'always', onAlways );
  // reset progress counter
  imageCount = imgLoad.images.length;
  resetProgress();
  updateProgress( 0 );
}

function myv(v)
{
  document.getElementById("demo").innerHTML+=v+'<hr>';
}
</script>

<p id="demo"></p>
