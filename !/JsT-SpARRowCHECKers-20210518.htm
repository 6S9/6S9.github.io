<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

<div id="Div1"></div>

<script type="text/javascript">

PushDataLoop();

function PushDataLoop() {
  var text = '{"ar":['+

  '{"t1":"sakura","p2":"'+
  'http://farm4.staticflickr.com/3864/14420d515212_9999c800b4_m.jpg'
  +'","t3":"","w4":"","h5":"","t6":"","u7":"'+
  'http://farm4.staticflickr.com/3864/14420s515212_9999c800b4_b.jpg'
  +'","a8":""}'

  +','+

  '{"t1":"sakura","p2":"'+
  'http://farm4.staticflickr.com/3864/14420515212_9999c800b4_m.jpg'
  +'","t3":"","w4":"","h5":"","t6":"","u7":"'+
  'http://farm4.staticflickr.com/3864/14420515212_9999c800b4_b.jpg'
  +'","a8":""}'

  +','+

  '{"t1":"","p2":"'+
  'https://pbs.twimg.com/media/Ev8-m-BVgAITNwN?format=jpg&name=thumb'
  +'","t3":"","w4":"","h5":"","t6":"","u7":"'+
  'https://pbs.twimg.com/media/Ev8-m-BVgAITNwN?format=jpg&name=orig'
  +'","a8":""}'

  +','+

  '{"t1":"trees","p2":"'+
  'http://farm8.staticflickr.com/7412/8732133694_0c7e400022_m.jpg'
  +'","t3":"","w4":"","h5":"","t6":"","u7":"'+
  'http://farm8.staticflickr.com/7412/8732133694_0c7e400022_b.jpg'
  +'","a8":""}'

  +','+

  '{"t1":"water","p2":"'+
  'http://farm4.staticflickr.com/3745/8971419780_cb88b22947_m.jpg'
  +'","t3":"","w4":"","h5":"","t6":"","u7":"'+
  'http://farm4.staticflickr.com/3745/8971419780_cb88b22947_b.jpg'
  +'","a8":""}'

  +','+

  '{"t1":"flower","p2":"'+
  'https://source.unsplash.com/ty4X72BSsXY/416x278'
  +'","t3":"","w4":"","h5":"","t6":"","u7":"'+
  'https://source.unsplash.com/ty4X72BSsXY/1279x853'
  +'","a8":""}'

  +','+

  '{"t1":"flower","p2":"'+
  'https://pbs.twimg.com/media/Ev8-m-BVgAITNwN?format=jpg&name=thumb'
  +'","t3":"","w4":"","h5":"","t6":"","u7":"'+
  'https://pbs.twimg.com/media/Ev8-m-BVgAITNwN?format=jpg&name=orig'
  +'","a8":""}'

  +']}';

  obj = JSON.parse(text);

  let promiseAll = [], img = [];
  for(let i = 0 ; i < obj.ar.length ; i++){
     promiseAll[i] = new Promise((resolve, reject)=>{
         img[i] = new Image();
         img[i].src = obj.ar[i].u7;
         img[i].onload = function(){
           for(let j = 0 ; j < obj.ar.length ; j++){
             if (img[j].width > 0 && img[j].height > 0) {
               p="";
               } else {
                 p="https://slack-imgs.com/?url=";
                 }
                 document.getElementById("s"+j).innerHTML='<a data-fancybox="gallery" href="'+p+obj.ar[j].u7+
                 '"><img src="'+p+obj.ar[j].p2+'" width="64"></a>';
             }
              //第i张加载完成
              resolve(img[i])
         }
     })
     let myEle = document.createElement("span");
     myEle.id = "s"+i;

     let wrapper = document.getElementById("Div1");
     wrapper.appendChild(myEle);
 }
 Promise.all(promiseAll).then((img)=>{
     //全部加载完成
 })
}

function EncryptAuth() {

}

</script>
